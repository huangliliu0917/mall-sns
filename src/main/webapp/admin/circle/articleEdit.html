<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>分类编辑</title>
    <link href="http://resali.huobanplus.com/cdn/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="http://resali.huobanplus.com/cdn/hotui/css/animate.min.css" rel="stylesheet"/>
    <link href="http://resali.huobanplus.com/cdn/hotui/css/style.min-1.0.2.css" rel="stylesheet"/>
</head>

<body class="gray-bg">
<div class="wrapper wrapper-content animated fadeInRight tooltip-demo">
    <div class="row">
        <div class="col-lg-12">
            <div class="ibox float-e-margins">
                <div class="ibox-content p-sm no-borders">
                    <div style="text-align: right;">
                        <button type="button" onclick="page.save()" class="btn btn-primary">保存</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <form role="form" id="edit_form" th:action="@{/top/circle/articleEdit.save}">
        <div class="row">
            <div class="col-lg-12">
                <div class="ibox float-e-margins">
                    <div class="tabs-container">
                        <div class="tab-content">
                            <div class="panel-body good-edit-failure form-horizontal">
                                <div class="hr-line-dashed "></div>
                                <div class="form-group ">
                                    <label class="col-sm-2 control-label">Id:</label>
                                    <div class="col-sm-10">
                                        <span th:text="${data.id}"></span>
                                        <input type="hidden" id="id" name="id" th:value="${data.id}"/>
                                        <input type="hidden" id="articleType" name="articleType" th:value="${data.articleType}"/>
                                    </div>
                                </div>
                                <div class="hr-line-dashed "></div>
                                <div class="form-group ">
                                    <label class="col-sm-2 control-label">标题:</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control input-sm" placeholder="标题" th:value="${data.name}" id="name" name="name"/>
                                    </div>
                                </div>

                                <div class="hr-line-dashed "></div>
                                <div class="form-group ">
                                    <label class="col-sm-2 control-label">发布用户:</label>
                                    <div class="col-sm-10">
                                        <input type="hidden" th:value="${data.userId}" id="userId" name="userId"/>
                                        <span id="divUser" th:text="${data.userName}"></span>
                                        <button class="btn btn-primary" type="button" onclick="page.selectUser()" id="btnUser">选择用户</button>
                                    </div>
                                </div>

                                <div class="hr-line-dashed "></div>
                                <div class="form-group ">
                                    <label class="col-sm-2 control-label">图片:</label>
                                    <div class="col-sm-10">
                                        <div class="col-sm-3">
                                            <img style="width: 300px;height: 200px" id="imgPictureUrl"
                                                 th:src="${data.pictureFullUrl==null}?'/img/300x200.png':${data.pictureFullUrl}"/>
                                        </div>
                                        <div class="col-sm-3">
                                            <label title="上传图片" for="fileImage" class="btn btn-primary">
                                                上传新图片
                                            </label>

                                            <span class="help-block m-b-none">推荐图片大小:300x200</span>
                                        </div>
                                        <input type="hidden" th:value="${data.pictureUrl}" id="pictureUrl" name="pictureUrl"/>
                                        <input type="file" name="fileImage" id="fileImage" class="hide" accept="image/*" style="display: none"/></div>
                                </div>

                                <div class="hr-line-dashed "></div>
                                <div class="form-group ">
                                    <label class="col-sm-2 control-label">内容:</label>
                                    <div class="col-sm-10">
                                        <textarea id="content" name="content" class="input-normal" th:text="${data.content}"></textarea>

                                    </div>
                                </div>

                                <div class="hr-line-dashed "></div>
                                <div class="form-group ">
                                    <label class="col-sm-2 control-label">简介:</label>
                                    <div class="col-sm-10">
                                        <textarea id="summary" name="summary" class="input-normal" th:text="${data.summary}" style="width: 500px;height: 200px;"></textarea>
                                    </div>
                                </div>

                                <div class="hr-line-dashed "></div>
                                <div class="form-group ">
                                    <label class="col-sm-2 control-label">分类:</label>
                                    <div class="col-sm-10">
                                        <input type="hidden" class="form-control input-sm" th:value="${data.categoryId}" id="categoryId" name="categoryId"/>
                                        <span id="divCategory" th:text="${data.categoryName}">选择分类</span>
                                        <button class="btn btn-primary" type="button" onclick="page.selectCategory()" id="btnCategory">选择分类</button>
                                    </div>
                                </div>

                                <div class="hr-line-dashed "></div>
                                <div class="form-group ">
                                    <label class="col-sm-2 control-label">圈子:</label>
                                    <div class="col-sm-10">
                                        <input type="hidden" class="form-control input-sm" th:value="${data.circleId}" id="circleId" name="circleId"/>
                                        <span id="divCircle" th:text="${data.circleName}"></span>
                                        <button class="btn btn-primary" type="button" onclick="page.selectCircle()" id="btnCircle">选择圈子</button>
                                    </div>
                                </div>

                                <div class="hr-line-dashed "></div>
                                <div class="form-group ">
                                    <label class="col-sm-2 control-label">广告:</label>
                                    <div class="col-sm-10">
                                        <textarea id="adConent" name="adConent" class="input-normal" th:text="${data.adConent}"></textarea>
                                    </div>
                                </div>

                                <div class="hr-line-dashed "></div>
                                <div class="form-group ">
                                    <label class="col-sm-2 control-label">标签:</label>
                                    <div class="col-sm-10">
                                        <button  class="btn btn-primary" type="button" onclick="page.addTags()" id="btnTags">添加标签</button>
                                        <div class="feed-activity-list">

                                            <div id="divTags">
                                                <th:block th:each="item:${data.tags}">
                                                    <div class="label" th:value="*{item.id}" th:onclick="'page.deleteTags(this)'" th:text="*{item.name}"></div>
                                                </th:block>
                                            </div>
                                            <input type="hidden" id="tags" name="tags"/>

                                        </div>
                                    </div>
                                </div>


                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>

    <div class="modal fade" id="modal_category">
        <div class="modal-dialog" style="width: 1000px;">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">×</button>
                    <h4 class="modal-title">选择分类</h4>
                </div>
                <div class="modal-body" style="height: 600px;">
                    <iframe id="frame_category" width="100%" height="100%" frameborder="0"></iframe>
                </div>
                <div class="modal-footer">
                    <button id="submitSelectCategory" class="btn btn-primary" type="button" onclick="page.submitSelectCategory(this)">确定选择</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modal_user">
        <div class="modal-dialog" style="width: 1000px;">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">×</button>
                    <h4 class="modal-title">选择用户</h4>
                </div>
                <div class="modal-body" style="height: 600px;">
                    <iframe id="frame_user" width="100%" height="100%" frameborder="0"></iframe>
                </div>
                <div class="modal-footer">
                    <button id="submitSelectUser" class="btn btn-primary" type="button" onclick="page.submitSelectUser(this)">确定选择</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modal_tags">
        <div class="modal-dialog" style="width: 1000px;">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">×</button>
                    <h4 class="modal-title">选择标签</h4>
                </div>
                <div class="modal-body" style="height: 600px;">
                    <iframe id="frame_tags" width="100%" height="100%" frameborder="0"></iframe>
                </div>
                <div class="modal-footer">
                    <button id="submitSelectTags" class="btn btn-success" type="button" onclick="page.submitSelectTags()" data-dismiss="modal">确定选择</button>
                </div>
            </div>
        </div>
    </div>
    <!--<div id="modal_category" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">-->
    <!--<iframe id="frame_category" width="100%" height="100%" frameborder="0" src="/top/category/categoryList/1?extend=radio"></iframe>-->
    <!--</div>-->
</div>

<!--基础框架js-->
<script src="http://resali.huobanplus.com/cdn/jquery/2.2.4/jquery.min.js"></script>
<script src="http://resali.huobanplus.com/cdn/bootstrap/3.3.5/bootstrap.min.js"></script>
<script src="http://resali.huobanplus.com/cdn/hotui/js/content.min.js"></script>
<script charset="utf-8" src="/js/kindeditor/kindeditor-min.js" type="text/javascript"></script>
<script charset="utf-8" src="/js/kindeditor/lang/zh_CN.js" type="text/javascript"></script>
<script type="text/javascript" src="/js/ajaxfileupload.js"></script>
<script src="/js/bootstrap.hot.extra-utils.js"></script>

<script>
    KindEditor.ready(function (K) {
        window.content = K.create('#content', {
            width: '700px'
            , height: '200px'
            , uploadJson: '/top/file/uploadUeImage'
            , items: [
                'source', 'undo', 'redo', '|', 'preview', 'cut', 'copy', 'paste',
                'plainpaste', 'wordpaste', '|', 'justifyleft', 'justifycenter', 'justifyright',
                'justifyfull', 'insertorderedlist', 'insertunorderedlist', 'indent', 'outdent', 'subscript',
                'superscript', 'clearhtml', 'quickformat', 'selectall', '|', 'fullscreen', '/',
                'formatblock', 'fontname', 'fontsize', '|', 'forecolor', 'hilitecolor', 'bold',
                'italic', 'underline', 'strikethrough', 'lineheight', 'removeformat', '|', 'image',
                'table', 'hr', 'emoticons', 'pagebreak',
                'anchor', 'link', 'unlink'
            ]
        });

        window.adConent = K.create('#adConent', {
            width: '700px'
            , height: '200px'
            , uploadJson: '/top/file/uploadUeImage'
            , items: [
                'source', 'undo', 'redo', '|', 'preview', 'cut', 'copy', 'paste',
                'plainpaste', 'wordpaste', '|', 'justifyleft', 'justifycenter', 'justifyright',
                'justifyfull', 'insertorderedlist', 'insertunorderedlist', 'indent', 'outdent', 'subscript',
                'superscript', 'clearhtml', 'quickformat', 'selectall', '|', 'fullscreen', '/',
                'formatblock', 'fontname', 'fontsize', '|', 'forecolor', 'hilitecolor', 'bold',
                'italic', 'underline', 'strikethrough', 'lineheight', 'removeformat', '|', 'image',
                'table', 'hr', 'emoticons', 'pagebreak',
                'anchor', 'link', 'unlink'
            ]
        });
    });


    var page = {};

    page.save = function () {
        $("#content").html(content.html());
        $("#adConent").html(adConent.html());
        $("#edit_form").submit();
    };


    page.selectCategory = function () {
        $("#frame_category").attr("src", "/top/category/categoryList/1?extend=radio");
        $("#btnCategory").attr("data-toggle", "modal");
        $("#btnCategory").attr("data-target", "#modal_category");
    }

    page.submitSelectCategory = function () {
        var category = $("#frame_category")[0].contentWindow.page.select();
        $("#categoryId").val(category.id);
        $("#divCategory").html(category.name);

        $("#submitSelectCategory").attr("data-dismiss", "modal");
    }


    page.selectUser = function () {
        $("#frame_user").attr("src", "/top/user/index?selectType=single");
        $("#btnUser").attr("data-toggle", "modal");
        $("#btnUser").attr("data-target", "#modal_user");

    }

    page.submitSelectUser = function () {
        var user = $("#frame_user")[0].contentWindow.page.selectOne();
        $("#userId").val(user.id);
        $("#divUser").html(user.name);

        $("#submitSelectUser").attr("data-dismiss", "modal");
    }


    page.addTags = function () {
        $("#frame_tags").attr("src", "/top/tags/tagsList?extend=checkbox");
        $("#btnTags").attr("data-toggle", "modal");
        $("#btnTags").attr("data-target", "#modal_tags");
    };

    page.submitSelectTags = function () {
        var select = $("#frame_tags")[0].contentWindow.page.select();
        if (select.length > 0) {
            for (var i = 0; select.length > i; i++) {
                if (!page.existTags(select[i].id)) {
                    $("#divTags").append('<div class="label" style="margin: 3px;"  value="' + select[i].id + '" onclick="page.deleteTags(this)">' + select[i].name + '</div>');
                }
            }
        }
        page.resetTags();
        $("#submitSelectTags").attr("data-dismiss", "modal");
    }

    page.existTags = function (id) {
        var result = false;
        $("#divTags div").each(function () {
            if ($(this).attr("value") == id) result = true;
        })
        return result;
    }

    page.deleteTags = function (obj) {
        $(obj).remove();
        page.resetTags();
    }

    page.resetTags = function () {
        var result = "";
        $("#divTags div").each(function () {
            result += $(this).attr("value") + ',';
        })
        if (result.length > 0) result = result.substr(0, result.length - 1);
        $("#tags").val(result);
    }

    $(function () {
        $("#fileImage").bind("change", function () {
            $.ajaxFileUpload({
                url: '/top/file/uploadAticleImage',
                secureuri: false,
                fileElementId: 'fileImage',
                dataType: 'json',
                data: null,
                success: function (resultModel) {
                    if (resultModel.code == 1) {
                        $("#imgPictureUrl").attr("src", resultModel.url);
                        $("#imgPictureUrl").show();
                        $("#pictureUrl").val(resultModel.message);
                    }
                    else {
                        alert(resultModel.message);
                    }
                },
                error: function (data, status, e) {
                    alert("上传失败，请检查网络后重试" + e);
                }
            });
        });


    })


</script>
</body>

</html>
